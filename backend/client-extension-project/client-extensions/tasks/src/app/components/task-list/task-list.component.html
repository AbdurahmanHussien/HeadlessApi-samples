<main class="app-wrapper main-content" [dir]="uiLabels[currentLang].dir">

  <div id="tabs" class="card tabs button-tabs-wrapper">
    <button class="ng-tab" [class.active]="currentSystem === 'MENDIX'" (click)="switchTab('MENDIX')">
      <p>Mendix</p>
      <span *ngIf="currentSystem === 'MENDIX'">({{ totalItems }})</span>
    </button>
    <button class="ng-tab" [class.active]="currentSystem === 'SPLUS'" (click)="switchTab('SPLUS')">
      <p>Service Plus</p>
      <span *ngIf="currentSystem === 'SPLUS'">({{ totalItems }})</span>
    </button>
    <button class="ng-tab" [class.active]="currentSystem === 'SAP'" (click)="switchTab('SAP')">
      <p>SAP</p>
      <span *ngIf="currentSystem === 'SAP'">({{ totalItems }})</span>

    </button>
    <button class="ng-tab" [class.active]="currentSystem === 'EDR'" (click)="switchTab('EDR')">
      <p>Edari</p>
      <span *ngIf="currentSystem === 'EDR'">({{ totalItems }})</span>
    </button>
  </div>
  <div class="card filter-card">
    <div class="filters">
      <div class="search-box">
        <img class="icon" src="/o/tmo-theme/images/tmo/search.svg" alt="search" />
        <input type="text"
               [placeholder]="uiLabels[currentLang].searchPlaceholder"
               [(ngModel)]="searchKeyword"
               (keyup.enter)="onSearch()" />
      </div>

      <div class="custom-select-input" (click)="toggleStatusDropdown()">
        <div class="arrow">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="7" viewBox="0 0 14 7" fill="none"><path d="M12.2787 0.966797L7.93208 5.31346C7.41875 5.8268 6.57875 5.8268 6.06542 5.31346L1.71875 0.966797" stroke="#6D6D6D" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <div class="select-trigger">{{ getStatusLabel() }}</div>

        <ul class="options" [style.display]="isStatusDropdownOpen ? 'block' : 'none'">
          <li *ngIf="selectedStatus === ''">{{uiLabels[currentLang].statusLabelDefault}}</li>
          <li (click)="$event.stopPropagation(); selectStatus('New')">New / جديد</li>
          <li (click)="$event.stopPropagation(); selectStatus('In Progress')">In Progress / قيد التنفيذ</li>
          <li (click)="$event.stopPropagation(); selectStatus('Approved')">Approved / مقبول</li>
          <li (click)="$event.stopPropagation(); selectStatus('Pending')">Pending / معلق</li>
          <li (click)="$event.stopPropagation(); selectStatus('Completed')">Completed / مكتمل</li>
          <li (click)="$event.stopPropagation(); selectStatus('Rejected')">Rejected / مرفوض</li>
        </ul>
      </div>
      <div class="custom-date">
        <input type="hidden" [(ngModel)]="selectedDate">
        <div class="icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="16"
            viewBox="0 0 14 16"
            fill="none"
          >
            <path
              d="M4.33464 8.00065C3.96645 8.00065 3.66797 8.29913 3.66797 8.66732C3.66797 9.03551 3.96645 9.33398 4.33464 9.33398H4.34062C4.70881 9.33398 5.00728 9.03551 5.00728 8.66732C5.00728 8.29913 4.70881 8.00065 4.34062 8.00065H4.33464Z"
              fill="#161616"
            />
            <path
              d="M6.99831 8.00065C6.63012 8.00065 6.33165 8.29913 6.33165 8.66732C6.33165 9.03551 6.63012 9.33398 6.99831 9.33398H7.00429C7.37248 9.33398 7.67096 9.03551 7.67096 8.66732C7.67096 8.29913 7.37248 8.00065 7.00429 8.00065H6.99831Z"
              fill="#161616"
            />
            <path
              d="M9.66199 8.00065C9.2938 8.00065 8.99532 8.29913 8.99532 8.66732C8.99532 9.03551 9.2938 9.33398 9.66199 9.33398H9.66797C10.0362 9.33398 10.3346 9.03551 10.3346 8.66732C10.3346 8.29913 10.0362 8.00065 9.66797 8.00065H9.66199Z"
              fill="#161616"
            />
            <path
              d="M4.33464 10.6673C3.96645 10.6673 3.66797 10.9658 3.66797 11.334C3.66797 11.7022 3.96645 12.0007 4.33464 12.0007H4.34062C4.70881 12.0007 5.00728 11.7022 5.00728 11.334C5.00728 10.9658 4.70881 10.6673 4.34062 10.6673H4.33464Z"
              fill="#161616"
            />
            <path
              d="M6.99831 10.6673C6.63012 10.6673 6.33165 10.9658 6.33165 11.334C6.33165 11.7022 6.63012 12.0007 6.99831 12.0007H7.00429C7.37248 12.0007 7.67096 11.7022 7.67096 11.334C7.67096 10.9658 7.37248 10.6673 7.00429 10.6673H6.99831Z"
              fill="#161616"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M3.5013 1.33398C3.5013 1.05784 3.27744 0.833984 3.0013 0.833984C2.72516 0.833984 2.5013 1.05784 2.5013 1.33398V1.75718C1.9648 1.90924 1.5123 2.15638 1.13567 2.56356C0.617058 3.12421 0.386535 3.8326 0.276135 4.72032C0.167956 5.59019 0.167962 6.70496 0.167969 8.12734V8.54063C0.167962 9.96301 0.167956 11.0778 0.276135 11.9476C0.386535 12.8354 0.617058 13.5438 1.13567 14.1044C1.6594 14.6706 2.32981 14.9274 3.16883 15.0493C3.98085 15.1673 5.01833 15.1673 6.32746 15.1673H7.67514C8.98427 15.1673 10.0218 15.1673 10.8338 15.0493C11.6728 14.9274 12.3432 14.6706 12.8669 14.1044C13.3855 13.5438 13.6161 12.8354 13.7265 11.9476C13.8346 11.0778 13.8346 9.963 13.8346 8.54061V8.12736C13.8346 6.70497 13.8346 5.59019 13.7265 4.72032C13.6161 3.8326 13.3855 3.12421 12.8669 2.56356C12.4903 2.15638 12.0378 1.90924 11.5013 1.75718V1.33398C11.5013 1.05784 11.2774 0.833984 11.0013 0.833984C10.7252 0.833984 10.5013 1.05784 10.5013 1.33398V1.57791C9.74393 1.50063 8.81195 1.50064 7.67514 1.50065H6.32747C5.19065 1.50064 4.25868 1.50063 3.5013 1.57791V1.33398ZM2.52037 2.80455C2.58001 3.01397 2.77275 3.16732 3.0013 3.16732C3.27744 3.16732 3.5013 2.94346 3.5013 2.66732V2.58371C4.20864 2.50169 5.12288 2.50065 6.36797 2.50065H7.63464C8.87972 2.50065 9.79396 2.50169 10.5013 2.58371V2.66732C10.5013 2.94346 10.7252 3.16732 11.0013 3.16732C11.2299 3.16732 11.4226 3.01397 11.4822 2.80455C11.7538 2.91259 11.9599 3.05569 12.1328 3.2426C12.4482 3.58358 12.635 4.05124 12.7334 4.83823C12.712 4.83543 12.6902 4.83398 12.668 4.83398H1.33464C1.31245 4.83398 1.2906 4.83543 1.26918 4.83823C1.36765 4.05124 1.55436 3.58358 1.86976 3.2426C2.04266 3.05569 2.24883 2.91259 2.52037 2.80455ZM1.19472 5.81415C1.16834 6.45609 1.16797 7.22488 1.16797 8.16281V8.50516C1.16797 9.97069 1.16888 11.0233 1.26849 11.8242C1.36678 12.6146 1.55363 13.0836 1.86976 13.4254C2.18078 13.7616 2.59949 13.9561 3.31266 14.0597C4.04447 14.1661 5.00922 14.1673 6.36797 14.1673H7.63464C8.99339 14.1673 9.95813 14.1661 10.6899 14.0597C11.4031 13.9561 11.8218 13.7616 12.1328 13.4254C12.449 13.0836 12.6358 12.6146 12.7341 11.8242C12.8337 11.0233 12.8346 9.97069 12.8346 8.50516V8.16281C12.8346 7.22488 12.8343 6.45609 12.8079 5.81415C12.7635 5.82706 12.7165 5.83398 12.668 5.83398H1.33464C1.28607 5.83398 1.23912 5.82706 1.19472 5.81415Z"
              fill="#161616"
            />
          </svg>
        </div>
        <div class="date-trigger">{{ selectedDate || uiLabels[currentLang].date  }}</div>
        <div class="calendar"></div>
      </div>
    </div>

    <div class="actions">
      <button class="search-button reset-btn" (click)="resetFilters()">{{ uiLabels[currentLang].reset }}</button>
      <button class="search-button" (click)="onSearch()">{{ uiLabels[currentLang].search }}</button>
    </div>
  </div>

  <div class="tabs-content">
    <div class="content-item active">
      <div class="table-wrapper table-primary">
        <table>
          <thead>
          <tr>
            <th>{{ uiLabels[currentLang].headers.id }}</th>
            <th>{{ uiLabels[currentLang].headers.title }}</th>
            <th>{{ uiLabels[currentLang].headers.date }}</th>
            <th>{{ uiLabels[currentLang].headers.status }}</th>
            <th style="width: 10%">{{ uiLabels[currentLang].headers.action }}</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let task of tasks">
            <td class="num">{{ task.TaskId }}</td>
            <td>{{ getTaskTitle(task) }}</td>
            <td>{{ task.CreatedDate }}</td>
            <td>
                <span class="status" [ngClass]="getStatusClass(task.TaskStatus)">
                  {{ task.TaskStatus }}
                </span>
            </td>
            <td class="action">
              <a [href]="task.TaskLink" target="_blank" class="icon-btn bg-primary-gradient" style="display:flex; justify-content:center; align-items:center;">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M0.596034 0.625843C0.405529 0.831275 0.299863 1.10233 0.233388 1.33308C0.162474 1.57925 0.114124 1.86082 0.0802664 2.15077C0.0124146 2.73184 -0.00454303 3.41321 0.000966071 4.05094C0.00650632 4.69226 0.034999 5.30658 0.0619552 5.75937C0.0754564 5.98615 0.0886277 6.17332 0.0984587 6.3042C0.103376 6.36967 0.107461 6.42111 0.11034 6.45644L0.113708 6.49712L0.114627 6.50793L0.114988 6.51212C0.144945 6.856 0.447996 7.11048 0.791871 7.08052C1.13573 7.05057 1.39016 6.74706 1.36023 6.40321L1.36005 6.40111L1.35928 6.39202L1.35621 6.35493C1.35353 6.32206 1.34965 6.27325 1.34495 6.21058C1.33553 6.08521 1.32281 5.90454 1.30975 5.68508C1.28357 5.24537 1.25622 4.65351 1.25092 4.04014C1.24559 3.42316 1.2628 2.8013 1.32183 2.29575C1.32515 2.26736 1.32857 2.23954 1.3321 2.21231L10.1863 11.0665C10.4304 11.3106 10.8261 11.3106 11.0702 11.0665C11.3143 10.8224 11.3143 10.4267 11.0702 10.1826L2.21393 1.32638C2.22589 1.32491 2.23797 1.32346 2.25017 1.32203C2.75003 1.26345 3.37539 1.24596 4.00038 1.25076C4.62146 1.25553 5.22463 1.2821 5.67379 1.30763C5.89798 1.32038 6.08289 1.33281 6.21137 1.34202C6.27559 1.34663 6.32565 1.35042 6.35941 1.35305L6.39754 1.35606L6.40962 1.35705C6.75359 1.38562 7.05561 1.12994 7.0842 0.785967C7.1128 0.441976 6.85671 0.139899 6.51272 0.111304L6.50889 0.110989L6.49788 0.110096L6.45634 0.106813C6.42024 0.104005 6.36766 0.10002 6.30078 0.0952228C6.16705 0.085632 5.97592 0.0727884 5.74473 0.0596468C5.28313 0.0334088 4.65821 0.00577458 4.00998 0.000794007C3.36566 -0.00415637 2.68049 0.0130496 2.10469 0.0805252C1.8178 0.114145 1.53906 0.162325 1.29814 0.23385C1.07859 0.299032 0.796608 0.409555 0.596034 0.625843Z" fill="#FCFCFD"/>
                </svg>
              </a>
            </td>
          </tr>
          <tr *ngIf="tasks.length === 0">
            <td colspan="5" style="text-align:center; padding: 30px;">
              {{ uiLabels[currentLang].empty }}
            </td>
          </tr>
          </tbody>
        </table>

        <div class="pagination-controls" *ngIf="totalItems > 0">

          <a class="page-item"
             [class.disabled]="currentPage === 1"
             (click)="currentPage > 1 && changePage(currentPage - 1)">
            &lt;
          </a>

          <ng-container *ngIf="paginationData.showFirst">
            <a class="page-item" (click)="changePage(1)">1</a>

            <span class="page-item dots" *ngIf="paginationData.showFirstEllipsis">...</span>
          </ng-container>

          <a *ngFor="let p of paginationData.pages"
             class="page-item"
             [class.active]="p === currentPage"
             (click)="changePage(p)">
            {{ p }}
          </a>

          <ng-container *ngIf="paginationData.showLast">

            <span class="page-item dots" *ngIf="paginationData.showLastEllipsis">...</span>

            <a class="page-item" (click)="changePage(totalPages)">{{ totalPages }}</a>
          </ng-container>

          <a class="page-item"
             [class.disabled]="currentPage === totalPages"
             (click)="currentPage < totalPages && changePage(currentPage + 1)">
            &gt;
          </a>

        </div>

      </div>
    </div>
  </div>
</main>
